@model IEnumerable<OutraChance.Models.Anuncio>



@{
    ViewData["Title"] = "Index";

    var caracteristicas = ViewData["Caracteristicas"] as List<Caracteristica>;
   
   
}




<table class="table">

   <div class="container">
       <div class="row g-1" style="margin-top:30px;">

            <form asp-action="Index" method="get" class="filtro-form">

                <div class="row align-items-start mt-2">
                    <div class="col-2" style="margin-left: -8px">
                        <!-- Select para Cidade -->
                        <select name="filtroDep" id="filtroDep" asp-items="ViewBag.filtroDep" style="width:175px">
                            <option value="">Departamento</option>
                        </select>
                    </div>
                    <div class="col-2">
                        <!-- Select para Estado -->
                        <select name="filtroGenero" id="filtroGenero" asp-items="ViewBag.filtroGenero" style="width:175px">
                            <option value="">Categoria</option>
                        </select>
                    </div>
                    <div class="col-2">
                        <!-- Select para Estado -->
                        <select name="filtroTamanho" id="filtroTamanho" asp-items="ViewBag.filtroTamanho" style="width:175px">
                            <option value="">Tamanho</option>
                        </select>
                    </div>
                    <div class="col-2">
                        <!-- Select para Estado -->
                        <select name="filtroEstado" id="filtroEstado" asp-items="ViewBag.filtroEstado" style="width:175px">
                            <option value="">Estado</option>
                        </select>
                    </div>

                    <div class="col-2">
                        <!-- Select para Estado -->
                        <select name="filtroCidade" id="filtroCidade" asp-items="ViewBag.filtroCidade" style="width:175px">
                            <option value="">Cidade</option>
                        </select>
                    </div>

                    <div class="col-2 align-content-end">
                        <button type="button" onclick="limparEFazerSubmit()" style="width:182px">Limpar Filtros</button>
                    </div>
                </div>
            </form>

    

    @foreach (var item in Model)
       
    { 
        
       <div class="col-3" style="margin-top:40px;">
        <div class="card" style="width: 16rem;">
            <img src="@Html.DisplayFor(modelItem => item.Imagem)" height="230px" width="254"></img>
            <div class="card-body">
                <h6 class="card-title"><b>@Html.DisplayFor(modelitem => item.Titulo)</b></h6>
                <h7><p class="card-text">@Html.DisplayFor(modelitem => item.Descricao)</p></h7>
                            @if (item.CaracteristicasAnuncios != null)
                            {


                                @foreach (var caracteristicasAnuncios in item.CaracteristicasAnuncios)
                                {
                                    if (caracteristicasAnuncios.CaracteristicaId == 4)
                                    {
                                        <h7>@caracteristicasAnuncios.Valor </h7>
                                    }
                                }
                            }
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    @if (item.CaracteristicasAnuncios != null)
                    {


                        @foreach (var caracteristicasAnuncios in item.CaracteristicasAnuncios)
                        {
                            if (caracteristicasAnuncios.CaracteristicaId == 2)
                            {
                                <h7>Tam: @caracteristicasAnuncios.Valor |</h7>
                            }
                        }
                    }
                    @if (item.CaracteristicasAnuncios != null)
                    {


                        @foreach (var caracteristicasAnuncios in item.CaracteristicasAnuncios)
                        {
                            if (caracteristicasAnuncios.CaracteristicaId == 1)
                            {
                                <h7>Cor: @caracteristicasAnuncios.Valor </h7>
                            }
                        }
                    }
                                
                </li>

               <br>

                <li class="list-group-item"><b>R$ @Html.DisplayFor(modelitem => item.Preco)</b> 
       
            </ul>
                <div class="row-10">
                    <a asp-controller="Anuncios" asp-action="Details" asp-route-id="@item.Id" class="btn btn-success" style="width:256px">Detalhes</a>
                </div>
           </div>
           </div>           
    }
   
    </div>
    </div>
    
    @section Scripts {

    <script>
        $(document).ready(function () {
            var dropdownCidade = $("#filtroCidade");
            var dropdownEstado = $("#filtroEstado");
            var dropdownCor = $("#filtroCor");
            var dropdownTamanho = $("#filtroTamanho");
            var dropdownDep = $("#filtroDep");
            var dropdownGenero = $("#filtroGenero");
            var form = $(".filtro-form");

            var itemselecionadoCidade = '@ViewContext.HttpContext.Request.Query["filtroCidade"].ToString()';
            var itemselecionadoEstado = '@ViewContext.HttpContext.Request.Query["filtroEstado"].ToString()';
            var itemselecionadoCor = '@ViewContext.HttpContext.Request.Query["filtroCor"].ToString()';
            var itemselecionadoTamanho = '@ViewContext.HttpContext.Request.Query["filtroTamanho"].ToString()';
            var itemselecionadoDep = '@ViewContext.HttpContext.Request.Query["filtroDep"].ToString()';
            var itemselecionadoGenero = '@ViewContext.HttpContext.Request.Query["filtroGenero"].ToString()';

            dropdownCidade.val(itemselecionadoCidade);
            dropdownEstado.val(itemselecionadoEstado);
            dropdownCor.val(itemselecionadoCor);
            dropdownTamanho.val(itemselecionadoTamanho);
            dropdownDep.val(itemselecionadoDep);
            dropdownGenero.val(itemselecionadoGenero);

            dropdownCidade.change(function () {
                form.submit();
            });

            dropdownEstado.change(function () {
                form.submit();
            });

            dropdownCor.change(function () {
                form.submit();
            });

            dropdownTamanho.change(function () {
                form.submit();
            });

            dropdownDep.change(function () {
                form.submit();
            });

            dropdownGenero.change(function () {
                form.submit();
            });

            var selectedValue = "@(ViewContext.HttpContext.Request.Query["filtro"].ToString())";
            ropdownCidade.val(selectedValue);
            var selectedValue2 = "@(ViewContext.HttpContext.Request.Query["filtro"].ToString())";
            dropdownEstado.val(selectedValue2);
            var selectedValue3 = "@(ViewContext.HttpContext.Request.Query["filtro"].ToString())";
            dropdownCor.val(selectedValue3);
         //   var selectedValue4 = "@(ViewContext.HttpContext.Request.Query["filtro"].ToString())";
         //   dropdownEstado.val(selectedValue4);
         //   var selectedValue5 = "@(ViewContext.HttpContext.Request.Query["filtro"].ToString())";
         //   dropdownEstado.val(selectedValue5);
         //   var selectedValue6 = "@(ViewContext.HttpContext.Request.Query["filtro"].ToString())";
         //   dropdownEstado.val(selectedValue6);
        });
    </script>

    <script>
        function limparEFazerSubmit() {
            
            voltarParaHomepage();
        }

        function voltarParaHomepage() {
            // Verificar forma correta de redirecionar
            window.location.href = 'https://localhost:44364/Anuncios';
        }
    </script>

        <script>
            document.getElementById('btnOpenModal').addEventListener('click', function () {
                // Abre o modal da view details
                $('#modalDadosAnunciante').modal('show');
            });
        </script>
}


